<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STOPWATCH</title>
<style>
  @font-face {
    font-family: "Science Gothic";
    src: url("fonts/ScienceGothic[CTRS,slnt,wdth,wght].ttf") format("truetype-variations"),
         url("fonts/ScienceGothic.ttf") format("truetype");
    font-weight: 100 900;
    font-style: normal;
    font-display: swap;
  }

  :root{
    --bg:#000;
    --fg:#fff;
    --muted: rgba(255,255,255,0.6);
    --panel: rgba(255,255,255,0.06);
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--fg);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .center-wrap{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    pointer-events:auto;
  }

  .time {
    font-family: "Science Gothic", "Orbitron", system-ui, sans-serif;
    font-variation-settings: "wdth" 120, "wght" 350, "slnt" 0, "CTRS" 0;
    font-feature-settings: "tnum" 1;
    font-variant-numeric: tabular-nums;
    font-size: clamp(48px, 12vw, 140px);
    line-height:0.9;
    letter-spacing: -0.07em;
    margin:0;
    padding:0;
    text-align:center;
    text-transform:uppercase;
  }

  .hint {
    margin-top:8px;
    font-size:12px;
    color:var(--muted);
    font-weight:600;
    letter-spacing:0.04em;
    text-transform:uppercase;
    text-align:center;
  }

  .reset-box{
    position:fixed;
    top:20px;
    right:20px;
    background:var(--panel);
    border-radius:12px;
    padding:10px 14px;
    font-size:14px;
    font-weight:600;
    text-transform:uppercase;
    letter-spacing:0.04em;
    opacity:0;
    pointer-events:none;
    transition:opacity .35s ease, transform .35s ease;
  }
  .reset-box.show{opacity:1;}

  .settings-btn{
    position:fixed;
    bottom:16px;
    right:16px;
    width:46px;
    height:46px;
    border-radius:999px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--panel);
    cursor:pointer;
    font-size:20px;
    user-select:none;
    z-index:100;
    transition:opacity .15s ease, transform .15s ease;
  }
  .settings-btn:hover{transform:scale(1.04);}

  .settings-menu{
    position:fixed;
    right:16px;
    bottom:16px;
    width:180px;
    border-radius:12px;
    overflow:hidden;
    transform: translateY(120px);
    transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .28s;
    opacity:0;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    backdrop-filter: blur(6px);
    z-index:99;
  }
  .settings-menu.open{
    transform: translateY(-78px);
    opacity:1;
  }
  .settings-menu .row{
    padding:10px 12px;
    display:flex;
    gap:8px;
    align-items:center;
  }
  .settings-menu label{
    cursor:pointer;
    font-size:13px;
    text-transform:uppercase;
    user-select:none;
  }
  input[type="radio"]{accent-color:#fff;}
</style>
</head>
<body>
  <div class="reset-box" id="resetBox">RESETTING IN 3</div>

  <div class="center-wrap" id="center">
    <div id="timeDisplay" class="time">0:00.0</div>
    <div class="hint" id="hint">PRESS SPACE TO START/STOP | HOLD SPACE TO FREEZE | HOLD R TO RESET</div>
  </div>

  <div class="settings-btn" id="settingsBtn" title="SETTINGS">⚙️</div>

  <div class="settings-menu" id="settingsMenu" aria-hidden="true">
    <div class="row">
      <input type="radio" id="d1" name="dec" value="1" checked>
      <label for="d1">1 DECIMAL</label>
    </div>
    <div class="row">
      <input type="radio" id="d2" name="dec" value="2">
      <label for="d2">2 DECIMALS</label>
    </div>
    <div class="row">
      <input type="radio" id="d3" name="dec" value="3">
      <label for="d3">3 DECIMALS</label>
    </div>
  </div>

<script>
(() => {
  const timeDisplay = document.getElementById('timeDisplay');
  const resetBox = document.getElementById('resetBox');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsMenu = document.getElementById('settingsMenu');
  const radioInputs = document.querySelectorAll('input[name="dec"]');

  let running = false;
  let frozen = false;
  let startTs = 0;
  let elapsed = 0;
  let raf = null;

  let resetInterval = null;
  const RESET_SECONDS = 3;
  let resetRemaining = RESET_SECONDS;

  let decimals = 1;

  function formatTime(ms){
    const totalMs = Math.floor(ms);
    const totalSec = Math.floor(totalMs / 1000);
    const min = Math.floor(totalSec / 60);
    const sec = totalSec % 60;
    const frac = Math.floor((totalMs % 1000) / Math.pow(10, 3 - decimals));
    return `${min}:${String(sec).padStart(2,'0')}.${String(frac).padStart(decimals,'0')}`.toUpperCase();
  }

  function render(){
    const now = performance.now();
    const curr = elapsed + (running && !frozen ? (now - startTs) : 0);
    timeDisplay.textContent = formatTime(curr);
    raf = requestAnimationFrame(render);
  }

  function startTimer(){
    if (running) return;
    running = true;
    startTs = performance.now();
    if (!raf) render();
  }
  function stopTimer(){
    if (!running) return;
    const now = performance.now();
    elapsed += Math.floor(now - startTs);
    running = false;
  }
  function resetNow(){
    running = false;
    frozen = false;
    elapsed = 0;
    timeDisplay.textContent = formatTime(0);
    resetBox.textContent = 'RESET!';
    setTimeout(()=>resetBox.classList.remove('show'),450);
  }

  function startResetCountdown(){
    if (resetInterval) return;
    resetRemaining = RESET_SECONDS;
    resetBox.textContent = `RESETTING IN ${resetRemaining}`;
    resetBox.classList.add('show');
    resetInterval = setInterval(()=>{
      resetRemaining--;
      if (resetRemaining>0){
        resetBox.textContent = `RESETTING IN ${resetRemaining}`;
      } else {
        clearInterval(resetInterval);
        resetInterval=null;
        resetNow();
      }
    },1000);
  }
  function cancelResetCountdown(){
    if (resetInterval){
      clearInterval(resetInterval);
      resetInterval=null;
    }
    resetBox.classList.remove('show');
  }

  window.addEventListener('keydown',(e)=>{
    if (e.code==='Space'){
      e.preventDefault();
      if (!running) startTimer();
      else frozen=true;
    } else if (e.code==='KeyR'){
      e.preventDefault();
      startResetCountdown();
    }
  });
  window.addEventListener('keyup',(e)=>{
    if (e.code==='Space'){
      e.preventDefault();
      if (frozen){
        frozen=false;
        startTs=performance.now();
      } else {
        if (running) stopTimer(); else startTimer();
      }
    } else if (e.code==='KeyR'){
      cancelResetCountdown();
    }
  });

  settingsBtn.addEventListener('click',()=>settingsMenu.classList.toggle('open'));
  window.addEventListener('click',(e)=>{
    if(!settingsMenu.contains(e.target)&&!settingsBtn.contains(e.target))
      settingsMenu.classList.remove('open');
  });

  radioInputs.forEach(r=>r.addEventListener('change',()=>{
    decimals=parseInt(r.value);
  }));

  timeDisplay.textContent=formatTime(0);
})();
</script>
</body>
</html>
