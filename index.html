<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stopwatch</title>

  <style>
    @font-face {
      font-family: "Science Gothic";
      src: url("fonts/ScienceGothic[CTRS,slnt,wdth,wght].ttf") format("truetype-variations");
      font-weight: 100 900;
      font-stretch: 50% 200%;
      font-style: normal;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-family: "Science Gothic", system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
    }

    .wrap {
      text-align: center;
      transform: translateZ(0);
      padding: 10px;
    }

    .time {
      font-size: clamp(48px, 11vw, 150px);
      letter-spacing: -0.04em;
      line-height: 0.9;
      font-variation-settings: "wdth" 120, "wght" 350;
      font-feature-settings: "tnum" 1;
    }

    .hint {
      margin-top: 10px;
      font-size: 11px;
      opacity: 0.7;
      font-weight: 500;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-family: "Science Gothic", system-ui, sans-serif;
    }

    .running .time {
      text-shadow: 0 4px 15px rgba(0,255,140,0.08);
    }

    .reset-box {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .reset-box.show {
      opacity: 1;
    }

    .settings {
      position: fixed;
      bottom: 20px;
      right: 20px;
      cursor: pointer;
      font-size: 20px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .settings:hover {
      opacity: 1;
    }

    .settings-menu {
      position: fixed;
      bottom: 60px;
      right: 20px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 10px 16px;
      display: none;
      text-align: left;
    }

    .settings-menu.show {
      display: block;
    }

    .settings-menu label {
      display: block;
      font-size: 12px;
      padding: 4px 0;
      cursor: pointer;
      font-family: "Science Gothic", system-ui, sans-serif;
    }

    ::selection { background: rgba(255,255,255,0.08); }
  </style>
</head>
<body>
  <div class="wrap" id="wrap">
    <div id="timeDisplay" class="time">0:00.0</div>
    <div class="hint">PRESS SPACE TO START | STOP | R TO RESET</div>
  </div>

  <div id="resetBox" class="reset-box"></div>
  <div class="settings" id="settingsBtn">⚙️</div>
  <div class="settings-menu" id="settingsMenu">
    <label><input type="radio" name="decimals" value="1" checked> 1 DECIMAL</label>
    <label><input type="radio" name="decimals" value="2"> 2 DECIMALS</label>
    <label><input type="radio" name="decimals" value="3"> 3 DECIMALS</label>
  </div>

  <script>
    (function(){
      const display = document.getElementById('timeDisplay');
      const wrap = document.getElementById('wrap');
      const resetBox = document.getElementById('resetBox');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsMenu = document.getElementById('settingsMenu');
      const decimalRadios = document.querySelectorAll('input[name="decimals"]');

      let running = false;
      let startTs = 0;
      let elapsed = 0;
      let rafId = null;
      let decimals = 1;
      let resetTimer = null;
      let resetHoldTime = 0;

      function formatTime(ms){
        const totalMilliseconds = Math.floor(ms);
        const msPart = Math.floor((totalMilliseconds % 1000) / Math.pow(10, 3 - decimals));
        const totalSeconds = Math.floor(totalMilliseconds / 1000);
        const seconds = totalSeconds % 60;
        const minutes = Math.floor(totalSeconds / 60);
        return `${minutes}:${String(seconds).padStart(2,'0')}.${String(msPart).padStart(decimals,'0')}`;
      }

      function render(){
        const now = performance.now();
        const currentElapsed = elapsed + (running ? Math.floor(now - startTs) : 0);
        display.textContent = formatTime(currentElapsed);
      }

      function tick(){
        render();
        rafId = requestAnimationFrame(tick);
      }

      function start(){
        if (running) return;
        running = true;
        startTs = performance.now();
        wrap.classList.add('running');
        if (!rafId) tick();
      }

      function stop(){
        if (!running) return;
        const now = performance.now();
        elapsed += Math.floor(now - startTs);
        running = false;
        wrap.classList.remove('running');
        render();
      }

      function reset(){
        running = false;
        elapsed = 0;
        wrap.classList.remove('running');
        render();
      }

      function toggle(){
        running ? stop() : start();
      }

      function showResetCountdown(){
        let countdown = 3;
        resetBox.textContent = `RESETTING IN ${countdown}`;
        resetBox.classList.add('show');
        resetTimer = setInterval(()=>{
          countdown--;
          if (countdown > 0) {
            resetBox.textContent = `RESETTING IN ${countdown}`;
          } else {
            clearInterval(resetTimer);
            reset();
            resetBox.textContent = 'RESET COMPLETE';
            setTimeout(()=>resetBox.classList.remove('show'), 600);
          }
        },1000);
      }

      window.addEventListener('keydown', e=>{
        if (e.code === 'Space'){
          e.preventDefault();
          toggle();
        } else if (e.key.toLowerCase() === 'r'){
          e.preventDefault();
          if (!resetTimer){
            showResetCountdown();
          }
        }
      });

      window.addEventListener('keyup', e=>{
        if (e.key.toLowerCase() === 'r'){
          clearInterval(resetTimer);
          resetTimer = null;
          resetBox.classList.remove('show');
        }
      });

      // touch support
      let touchHold = null;
      document.addEventListener('touchstart', e=>{
        const touch = e.touches[0];
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        if (touch.clientY < vh * 0.25 && touch.clientX > vw * 0.7){
          showResetCountdown();
        }
      });
      document.addEventListener('touchend', ()=>{
        clearInterval(resetTimer);
        resetTimer = null;
        resetBox.classList.remove('show');
      });

      // settings toggle
      settingsBtn.addEventListener('click', ()=>{
        settingsMenu.classList.toggle('show');
      });

      decimalRadios.forEach(r=>{
        r.addEventListener('change', ()=>{
          decimals = parseInt(r.value);
          render();
        });
      });

      render();
    })();
  </script>
</body>
</html>
