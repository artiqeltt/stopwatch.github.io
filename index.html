<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stopwatch</title>
  <style>
    @font-face {
      font-family: 'ScienceGothic';
      src: url('fonts/ScienceGothic[CTRS,slnt,wdth,wght].ttf') format('truetype');
    }

    html, body {
      height: 100%;
      margin: 0;
      background: black;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'ScienceGothic', sans-serif;
      user-select: none;
      text-transform: uppercase;
    }

    #stopwatch {
      font-size: clamp(60px, 10vw, 150px);
      letter-spacing: -0.02em;
      font-variant-numeric: tabular-nums;
      font-variation-settings: "wght" 350, "wdth" 100;
      line-height: 0.9;
    }

    #instruction {
      font-size: 12px;
      letter-spacing: 0.12em;
      margin-top: 10px;
      font-weight: 400;
      opacity: 0.75;
      font-family: 'ScienceGothic', sans-serif;
    }

    #resetBox {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px 20px;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.4s ease;
      font-family: 'ScienceGothic', sans-serif;
    }

    #resetBox.show {
      opacity: 1;
    }

    #settings {
      position: absolute;
      bottom: 20px;
      right: 20px;
      font-size: 22px;
      cursor: pointer;
      transition: opacity 0.2s ease;
      opacity: 0.6;
    }

    #settings:hover {
      opacity: 1;
    }

    #settingsMenu {
      position: absolute;
      bottom: 60px;
      right: 20px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      padding: 12px 16px;
      display: none;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
      min-width: 130px;
      font-family: 'ScienceGothic', sans-serif;
    }

    .settings-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .settings-option input {
      accent-color: white;
      cursor: pointer;
    }

    .settings-option label {
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="stopwatch">0:00.0</div>
  <div id="instruction">PRESS SPACE TO START/STOP • HOLD R TO RESET</div>
  <div id="resetBox">RESETTING IN 3.0S</div>
  <div id="settings">⚙️</div>

  <div id="settingsMenu">
    <div class="settings-option">
      <input type="radio" name="decimals" id="dec1" value="1" checked>
      <label for="dec1">1 DECIMAL</label>
    </div>
    <div class="settings-option">
      <input type="radio" name="decimals" id="dec2" value="2">
      <label for="dec2">2 DECIMALS</label>
    </div>
    <div class="settings-option">
      <input type="radio" name="decimals" id="dec3" value="3">
      <label for="dec3">3 DECIMALS</label>
    </div>
  </div>

  <script>
    const display = document.getElementById('stopwatch');
    const resetBox = document.getElementById('resetBox');
    const settingsBtn = document.getElementById('settings');
    const settingsMenu = document.getElementById('settingsMenu');
    let startTime = 0;
    let running = false;
    let timerInterval;
    let decimals = 1;
    let resetCountdown;
    let resetHoldTime = 3;

    function formatTime(ms) {
      const totalMilliseconds = Math.floor(ms);
      const totalSeconds = Math.floor(totalMilliseconds / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      const fraction = Math.floor((totalMilliseconds % 1000) / Math.pow(10, 3 - decimals));
      return `${minutes}:${String(seconds).padStart(2, '0')}.${fraction.toString().padStart(decimals, '0')}`;
    }

    function updateDisplay(time) {
      display.textContent = formatTime(time);
    }

    function startStopwatch() {
      startTime = Date.now() - parseFloat(display.dataset.elapsed || 0);
      running = true;
      timerInterval = setInterval(() => {
        updateDisplay(Date.now() - startTime);
      }, 10);
    }

    function stopStopwatch() {
      running = false;
      clearInterval(timerInterval);
      display.dataset.elapsed = Date.now() - startTime;
    }

    function resetStopwatch() {
      stopStopwatch();
      updateDisplay(0);
      display.dataset.elapsed = 0;
    }

    document.body.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (running) stopStopwatch();
        else startStopwatch();
      }
      if (e.code === 'KeyR') {
        let timeLeft = resetHoldTime;
        resetBox.textContent = `RESETTING IN ${timeLeft.toFixed(1)}S`;
        resetBox.classList.add('show');
        resetCountdown = setInterval(() => {
          timeLeft -= 0.1;
          if (timeLeft <= 0) {
            resetStopwatch();
            clearInterval(resetCountdown);
            resetBox.textContent = `RESETTING IN 0.0S`;
            setTimeout(() => resetBox.classList.remove('show'), 600);
          } else {
            resetBox.textContent = `RESETTING IN ${timeLeft.toFixed(1)}S`;
          }
        }, 100);
      }
    });

    document.body.addEventListener('keyup', (e) => {
      if (e.code === 'KeyR') {
        clearInterval(resetCountdown);
        resetBox.classList.remove('show');
      }
    });

    settingsBtn.addEventListener('click', () => {
      settingsMenu.style.display = settingsMenu.style.display === 'flex' ? 'none' : 'flex';
    });

    document.querySelectorAll('input[name="decimals"]').forEach(radio => {
      radio.addEventListener('change', () => {
        decimals = parseInt(radio.value);
        updateDisplay((Date.now() - startTime) || 0);
      });
    });

    updateDisplay(0);
  </script>
</body>
</html>
