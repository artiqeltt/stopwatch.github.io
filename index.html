<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stopwatch</title>
  <style>
    @font-face {
      font-family: 'ScienceGothic';
      src: url('fonts/ScienceGothic.ttf') format('truetype');
    }

    body {
      background-color: black;
      color: white;
      font-family: 'ScienceGothic', sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      user-select: none;
    }

    #stopwatch {
      font-size: 130px;
      font-weight: 350;
      letter-spacing: 0.15em;
    }

    #instructions {
      margin-top: 20px;
      font-size: 14px;
      opacity: 0.8;
      font-family: 'ScienceGothic', sans-serif;
    }

    #resetBox {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #settingsIcon {
      position: absolute;
      bottom: 20px;
      right: 20px;
      font-size: 26px;
      cursor: pointer;
      opacity: 0.8;
    }

    #settings {
      position: absolute;
      bottom: 70px;
      right: 20px;
      background: rgba(255,255,255,0.08);
      padding: 12px;
      border-radius: 10px;
      display: none;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
    }

    #settings label {
      display: flex;
      align-items: center;
      gap: 6px;
    }
  </style>
</head>
<body>
  <div id="stopwatch">00:00.0</div>
  <div id="instructions">SPACE | START / STOP | HOLD R | RESET</div>
  <div id="resetBox">resetting in 3...</div>
  <div id="settingsIcon">⚙️</div>

  <div id="settings">
    <label><input type="radio" name="decimals" value="1" checked> 1 decimal</label>
    <label><input type="radio" name="decimals" value="2"> 2 decimals</label>
    <label><input type="radio" name="decimals" value="3"> 3 decimals</label>
  </div>

  <script>
    let time = 0;
    let running = false;
    let lastTimestamp = 0;
    let decimals = 1;
    const display = document.getElementById("stopwatch");
    const resetBox = document.getElementById("resetBox");
    const settingsIcon = document.getElementById("settingsIcon");
    const settings = document.getElementById("settings");
    let resetHoldTime = 0;
    let resetInterval;
    let fadeTimeout;
    let rafId;

    function updateDisplay() {
      const totalSeconds = time / 1000;
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      display.textContent = `${String(minutes).padStart(2, '0')}:${seconds.toFixed(decimals).padStart(2 + decimals, '0')}`;
    }

    function updateTimer(timestamp) {
      if (!running) return;
      if (!lastTimestamp) lastTimestamp = timestamp;
      const delta = timestamp - lastTimestamp;
      time += delta;
      lastTimestamp = timestamp;
      updateDisplay();
      rafId = requestAnimationFrame(updateTimer);
    }

    function startStop() {
      if (running) {
        running = false;
        cancelAnimationFrame(rafId);
        lastTimestamp = 0; // prevents flicker
      } else {
        running = true;
        lastTimestamp = 0;
        rafId = requestAnimationFrame(updateTimer);
      }
    }

    function resetHoldStart() {
      resetHoldTime = 0;
      resetBox.style.opacity = 1;
      resetInterval = setInterval(() => {
        resetHoldTime += 0.1;
        resetBox.textContent = `resetting in ${(3 - resetHoldTime).toFixed(1)}...`;
        if (resetHoldTime >= 3) {
          clearInterval(resetInterval);
          time = 0;
          updateDisplay();
          resetBox.textContent = "reset!";
          fadeTimeout = setTimeout(() => {
            resetBox.style.opacity = 0;
          }, 500);
        }
      }, 100);
    }

    function resetHoldEnd() {
      clearInterval(resetInterval);
      resetBox.style.opacity = 0;
    }

    settingsIcon.addEventListener("click", () => {
      settings.style.display = settings.style.display === "none" ? "flex" : "none";
    });

    document.querySelectorAll('input[name="decimals"]').forEach(input => {
      input.addEventListener("change", e => {
        decimals = parseInt(e.target.value);
        updateDisplay();
      });
    });

    document.addEventListener("keydown", e => {
      if (e.code === "Space") {
        e.preventDefault();
        startStop();
      } else if (e.code === "KeyR") {
        resetHoldStart();
      }
    });

    document.addEventListener("keyup", e => {
      if (e.code === "KeyR") {
        resetHoldEnd();
      }
    });

    updateDisplay();
  </script>
</body>
</html>
