<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stopwatch</title>

<style>
  @font-face {
    font-family: "Science Gothic";
    src: url("fonts/ScienceGothic[CTRS,slnt,wdth,wght].ttf") format("truetype-variations");
    font-weight: 100 900;
    font-stretch: 50% 200%;
    font-style: normal;
  }

  html, body {
    height: 100%;
    margin: 0;
    background: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "Science Gothic", system-ui, sans-serif;
    -webkit-font-smoothing: antialiased;
    overflow: hidden;
    user-select: none;
  }

  .wrap {
    text-align: center;
  }

  .time {
    font-size: clamp(48px, 10vw, 140px);
    font-variation-settings: "wdth" 120, "wght" 400;
    letter-spacing: -0.03em;
  }

  .hint {
    margin-top: 8px;
    font-size: 12px;
    opacity: 0.6;
    text-transform: uppercase;
  }

  .reset-box {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 10px 16px;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }

  .reset-box.show { opacity: 1; }

  .settings-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .settings-btn:hover { background: rgba(255,255,255,0.2); }

  .settings-box {
    position: fixed;
    bottom: -120px;
    right: 20px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 12px;
    width: 160px;
    text-align: center;
    transition: bottom 0.3s ease;
  }

  .settings-box.show {
    bottom: 80px;
  }

  .option {
    padding: 6px;
    margin: 4px 0;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .option:hover {
    background: rgba(255,255,255,0.2);
  }

  .option.active {
    background: rgba(255,255,255,0.3);
  }

</style>
</head>
<body>
  <div class="reset-box" id="resetBox">Resetting in 3</div>

  <div class="wrap" id="wrap">
    <div id="timeDisplay" class="time">0:00.0</div>
    <div class="hint">PRESS SPACE OR TAP TO START/STOP | HOLD R OR HOLD TAP TO RESET</div>
  </div>

  <div class="settings-btn" id="settingsBtn">⚙️</div>
  <div class="settings-box" id="settingsBox">
    <div class="option" data-decimals="1">1 Decimal</div>
    <div class="option" data-decimals="2">2 Decimals</div>
    <div class="option" data-decimals="3">3 Decimals</div>
  </div>

  <script>
    (function(){
      const display = document.getElementById('timeDisplay');
      const wrap = document.getElementById('wrap');
      const resetBox = document.getElementById('resetBox');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsBox = document.getElementById('settingsBox');
      const options = document.querySelectorAll('.option');

      let running = false;
      let startTs = 0;
      let elapsed = 0;
      let rafId = null;
      let resetHoldTimer = null;
      let resetCountdown = 0;
      let resetActive = false;
      let decimalPlaces = 1;

      function formatTime(ms){
        const totalMilliseconds = Math.floor(ms);
        const totalSeconds = totalMilliseconds / 1000;
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = (totalSeconds % 60).toFixed(decimalPlaces);
        return `${minutes}:${seconds.padStart(2 + decimalPlaces + 1, '0')}`;
      }

      function render(){
        const now = performance.now();
        const currentElapsed = elapsed + (running ? now - startTs : 0);
        display.textContent = formatTime(currentElapsed);
      }

      function tick(){
        render();
        rafId = requestAnimationFrame(tick);
      }

      function start(){
        if (running) return;
        running = true;
        startTs = performance.now();
        if (!rafId) tick();
      }

      function stop(){
        if (!running) return;
        const now = performance.now();
        elapsed += now - startTs;
        running = false;
        render();
      }

      function toggle(){
        running ? stop() : start();
      }

      function reset(){
        running = false;
        elapsed = 0;
        render();
        setTimeout(()=>resetBox.classList.remove('show'),400);
      }

      function startResetCountdown(){
        if (resetActive) return;
        resetActive = true;
        resetCountdown = 3;
        resetBox.textContent = `Resetting in ${resetCountdown}`;
        resetBox.classList.add('show');
        resetHoldTimer = setInterval(()=>{
          resetCountdown--;
          if (resetCountdown <= 0){
            clearInterval(resetHoldTimer);
            resetHoldTimer = null;
            resetActive = false;
            reset();
          } else {
            resetBox.textContent = `Resetting in ${resetCountdown}`;
          }
        }, 1000);
      }

      function cancelResetCountdown(){
        if (resetHoldTimer){
          clearInterval(resetHoldTimer);
          resetHoldTimer = null;
        }
        resetBox.classList.remove('show');
        resetActive = false;
      }

      // keyboard
      window.addEventListener('keydown', e=>{
        if (e.code === 'Space'){ e.preventDefault(); toggle(); }
        else if (e.key.toLowerCase() === 'r'){ startResetCountdown(); }
      });
      window.addEventListener('keyup', e=>{
        if (e.key.toLowerCase() === 'r') cancelResetCountdown();
      });

      // touch
      let touchTimeout = null;
      let touchStartTime = 0;
      window.addEventListener('touchstart', e=>{
        e.preventDefault();
        touchStartTime = Date.now();
        touchTimeout = setTimeout(()=>startResetCountdown(), 500);
      }, {passive:false});
      window.addEventListener('touchend', e=>{
        e.preventDefault();
        const duration = Date.now() - touchStartTime;
        if (duration < 500) toggle();
        cancelResetCountdown();
        clearTimeout(touchTimeout);
      }, {passive:false});

      // settings
      settingsBtn.onclick = ()=>{
        settingsBox.classList.toggle('show');
      };

      options.forEach(opt=>{
        opt.onclick = ()=>{
          decimalPlaces = parseInt(opt.dataset.decimals);
          options.forEach(o=>o.classList.remove('active'));
          opt.classList.add('active');
          settingsBox.classList.remove('show');
          render();
        };
      });

      // default active
      options[0].classList.add('active');
      render();
    })();
  </script>
</body>
</html>
