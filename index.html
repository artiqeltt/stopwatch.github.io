<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stopwatch</title>
<style>
  @font-face {
    font-family: 'ScienceGothic';
    src: url('fonts/ScienceGothic[CTRS,slnt,wdth,wght].ttf') format('truetype');
    font-display: swap;
  }

  :root {
    --bg:#000;
    --fg:#fff;
    --panel: rgba(255,255,255,0.08);
    --muted: rgba(255,255,255,0.75);
  }

  html,body {
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family: 'ScienceGothic', system-ui, sans-serif;
    text-transform: uppercase;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    user-select:none;
    overflow:hidden;
  }

  .time {
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum" 1;
    font-size: clamp(72px, 13vw, 160px);
    font-variation-settings: "wght" 350, "wdth" 100;
    letter-spacing: -0.02em;
    line-height: 0.9;
    text-align:center;
  }

  .hint {
    margin-top:8px;
    font-size:12px;
    color:var(--muted);
    font-weight:600;
    letter-spacing:0.12em;
    text-align:center;
  }

  .reset-box {
    position:fixed;
    top:20px;
    right:20px;
    background:var(--panel);
    border-radius:12px;
    padding:10px 14px;
    font-size:14px;
    font-weight:600;
    letter-spacing:0.04em;
    opacity:0;
    pointer-events:none;
    transition:opacity .35s ease;
  }
  .reset-box.show { opacity:1; }

  .settings {
    position:fixed;
    bottom:16px;
    right:16px;
    width:44px;
    height:44px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--panel);
    border-radius:999px;
    cursor:pointer;
    z-index:100;
    font-size:20px;
  }

  .settings-menu {
    position:fixed;
    right:16px;
    bottom:70px;
    width:160px;
    border-radius:12px;
    overflow:hidden;
    transform: translateY(120px);
    transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .28s;
    opacity:0;
    background: rgba(255,255,255,0.04);
    backdrop-filter: blur(6px);
    z-index:99;
    padding:8px;
    box-sizing:border-box;
  }
  .settings-menu.open {
    transform: translateY(0);
    opacity:1;
  }

  .settings-option {
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px;
    cursor:pointer;
  }

  .settings-option input { accent-color:#fff; }
  .settings-option label {
    font-size:13px;
    user-select:none;
  }
</style>
</head>
<body>
  <div class="reset-box" id="resetBox">RESETTING IN 3</div>

  <div id="timeDisplay" class="time">0:00.0</div>
  <div class="hint" id="hint">PRESS SPACE TO START/STOP | HOLD SPACE TO FREEZE | HOLD R TO RESET</div>

  <div class="settings" id="settingsBtn" title="Settings">⚙️</div>

  <div class="settings-menu" id="settingsMenu" aria-hidden="true">
    <div class="settings-option">
      <input type="radio" id="d1" name="dec" value="1" checked>
      <label for="d1">1 DECIMAL</label>
    </div>
    <div class="settings-option">
      <input type="radio" id="d2" name="dec" value="2">
      <label for="d2">2 DECIMALS</label>
    </div>
    <div class="settings-option">
      <input type="radio" id="d3" name="dec" value="3">
      <label for="d3">3 DECIMALS</label>
    </div>
  </div>

<script>
(() => {
  const timeDisplay = document.getElementById('timeDisplay');
  const resetBox = document.getElementById('resetBox');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsMenu = document.getElementById('settingsMenu');
  const radios = document.querySelectorAll('input[name="dec"]');

  let running = false;
  let frozen = false;
  let startTs = 0;
  let elapsedMs = 0;
  let raf = null;
  const RESET_SECONDS = 3;
  let resetInterval = null;
  let resetRemaining = RESET_SECONDS;
  let decimals = 1;

  function formatTime(ms){
    const totalMs = Math.max(0, Math.floor(ms));
    const totalSeconds = Math.floor(totalMs / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    const fractionMs = totalMs % 1000;
    const scaled = Math.floor(fractionMs / Math.pow(10, 3 - decimals));
    const fracStr = String(scaled).padStart(decimals, '0');
    return `${minutes}:${String(seconds).padStart(2,'0')}.${fracStr}`;
  }

  function render(){
    if (running && !frozen){
      const current = performance.now();
      timeDisplay.textContent = formatTime(elapsedMs + (current - startTs));
    }
    raf = requestAnimationFrame(render);
  }

  function startRAF(){
    if (!raf) raf = requestAnimationFrame(render);
  }

  function stopRAF(){
    if (raf){ cancelAnimationFrame(raf); raf = null; }
  }

  function startTimer(){
    if (running) return;
    running = true;
    startTs = performance.now();
    startRAF();
  }

  function stopTimer(){
    if (!running) return;
    elapsedMs += performance.now() - startTs;
    running = false;
  }

  function resetNow(){
    running = false;
    frozen = false;
    elapsedMs = 0;
    timeDisplay.textContent = formatTime(0);
    resetBox.textContent = 'RESET!';
    setTimeout(()=> resetBox.classList.remove('show'), 450);
  }

  function startResetCountdown(){
    if (resetInterval) return;
    resetRemaining = RESET_SECONDS;
    resetBox.textContent = `RESETTING IN ${resetRemaining}`;
    resetBox.classList.add('show');
    resetInterval = setInterval(()=>{
      resetRemaining--;
      if (resetRemaining>0){
        resetBox.textContent = `RESETTING IN ${resetRemaining}`;
      } else {
        clearInterval(resetInterval);
        resetInterval=null;
        resetNow();
      }
    },1000);
  }

  function cancelResetCountdown(){
    if (resetInterval){
      clearInterval(resetInterval);
      resetInterval=null;
    }
    resetBox.classList.remove('show');
  }

  window.addEventListener('keydown',e=>{
    if (e.code==='Space'){
      e.preventDefault();
      if (!running){
        startTimer();
      } else {
        frozen = true;
      }
    } else if (e.code==='KeyR'){
      e.preventDefault();
      startResetCountdown();
    }
  });

  window.addEventListener('keyup',e=>{
    if (e.code==='Space'){
      e.preventDefault();
      if (frozen){
        frozen = false;
        startTs = performance.now();
      } else {
        if (running) stopTimer();
        else startTimer();
      }
    } else if (e.code==='KeyR'){
      cancelResetCountdown();
    }
  });

  settingsBtn.addEventListener('click',e=>{
    e.stopPropagation();
    settingsMenu.classList.toggle('open');
  });

  window.addEventListener('click',e=>{
    if (!settingsMenu.contains(e.target) && !settingsBtn.contains(e.target)){
      settingsMenu.classList.remove('open');
    }
  });

  radios.forEach(r=>r.addEventListener('change',()=>{
    decimals=parseInt(r.value,10);
    timeDisplay.textContent=formatTime(elapsedMs);
  }));

  timeDisplay.textContent=formatTime(0);
  startRAF();
})();
</script>
</body>
</html>
